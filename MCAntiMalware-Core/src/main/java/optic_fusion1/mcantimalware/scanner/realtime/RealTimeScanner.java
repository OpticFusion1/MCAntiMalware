package optic_fusion1.mcantimalware.scanner.realtime;

import java.io.File;
import java.nio.file.Path;
import optic_fusion1.mcantimalware.Main;
import static optic_fusion1.mcantimalware.Main.LOGGER;
import optic_fusion1.mcantimalware.scanner.Scanner;

public class RealTimeScanner extends Scanner {

  private Main main;

  public RealTimeScanner(Main main, File scanDirectory) {
    super(main, scanDirectory);
    this.main = main;
  }

  public void setupDirectoryWatcher() {
	DirectoryWatcher directoryWatcher = new DirectoryWatcher.Builder().addDirectories(getScanDirectory().toPath())
		.setPreExistingAsCreated(true).build(main, (DirectoryWatcher.Event event, Path path) -> {
		  switch (event) {
		  case ENTRY_CREATE:
			addFileToQueue(path);
			break;
		  case ENTRY_MODIFY:
			addFileToQueue(path);
			break;
		  case ENTRY_DELETE:
			break;
		  }
		});

    try {
      directoryWatcher.startService(); // Actual watching starts here
    } catch (Exception e) {
      LOGGER.exception(e);
    }
  }

}
