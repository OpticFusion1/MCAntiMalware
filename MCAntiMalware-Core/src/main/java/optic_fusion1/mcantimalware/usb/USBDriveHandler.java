package optic_fusion1.mcantimalware.usb;

import java.io.File;
import net.samuelcampos.usbdrivedetector.USBDeviceDetectorManager;
import net.samuelcampos.usbdrivedetector.events.DeviceEventType;
import net.samuelcampos.usbdrivedetector.events.IUSBDriveListener;
import net.samuelcampos.usbdrivedetector.events.USBStorageEvent;
import optic_fusion1.mcantimalware.Main;
import optic_fusion1.mcantimalware.scanner.Scanner;

public class USBDriveHandler implements IUSBDriveListener {

  private final Scanner scanner;

  public USBDriveHandler(Main main) {
    scanner = main.getScanner();
    USBDeviceDetectorManager driveDetector = new USBDeviceDetectorManager();
    driveDetector.addDriveListener(this);
    driveDetector.setPollingInterval(1);
  }

  @Override
  public void usbDriveEvent(USBStorageEvent event) {
    if (event.getEventType() == DeviceEventType.CONNECTED) {
      for (File file : event.getStorageDevice().getRootDirectory().listFiles()) {
        if (file.isDirectory()) {
          scanner.scanDirectory(file.toPath());
        } else {
          scanner.scanFile(file.toPath());
        }
      }
    }
  }

}
