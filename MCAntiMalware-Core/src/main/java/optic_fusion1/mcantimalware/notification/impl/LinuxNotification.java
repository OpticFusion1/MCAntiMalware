package optic_fusion1.mcantimalware.notification.impl;

import java.awt.Image;
import java.awt.Toolkit;
import java.awt.TrayIcon;
import java.io.File;
import java.io.IOException;
import java.nio.file.CopyOption;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.StandardCopyOption;

import es.blackleg.jlibnotify.LibNotify;
import es.blackleg.jlibnotify.Notification;
import es.blackleg.jlibnotify.core.DefaultLibNotifyLoader;
import optic_fusion1.mcantimalware.Main;
import optic_fusion1.mcantimalware.check.CheckResult;
import optic_fusion1.mcantimalware.notification.NotificationSender;
import optic_fusion1.mcantimalware.utils.I18n;

public class LinuxNotification implements NotificationSender {

	private LibNotify libNotify;

	private Path notificationImage;

	public LinuxNotification() {
		libNotify = DefaultLibNotifyLoader.getInstance().load();
		libNotify.init("AntiMalware");
		try {
			notificationImage = File.createTempFile("notificationImage", "").toPath();
			Files.copy(Main.class.getResource("/index.jpg").openStream(), notificationImage,
					StandardCopyOption.REPLACE_EXISTING);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}

	@Override
	public void notifyDetectedFile(Path path, CheckResult result) {
		Notification notification = libNotify.createNotification(
				I18n.tl("malware_detected_tool_tip_title"), I18n.tl("might_be_infected_tool_tip_text", path,
						result.getPlatform(), result.getType(), result.getFamily(), result.getVariant(), result.getClassNodePath()),
				notificationImage.toAbsolutePath().toString());
		libNotify.showNotification(notification);
	}

}
