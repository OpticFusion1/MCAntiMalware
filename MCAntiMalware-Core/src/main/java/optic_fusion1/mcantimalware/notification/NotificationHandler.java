package optic_fusion1.mcantimalware.notification;

import java.nio.file.Path;
import optic_fusion1.mcantimalware.CommandLineParser;
import optic_fusion1.mcantimalware.Main;
import optic_fusion1.mcantimalware.check.CheckResult;
import optic_fusion1.mcantimalware.notification.impl.DiscordNotification;
import optic_fusion1.mcantimalware.notification.impl.LinuxNotification;
import optic_fusion1.mcantimalware.notification.impl.WindowsNotification;
import optic_fusion1.mcantimalware.utils.OsCheck;

public class NotificationHandler {

	private CommandLineParser commandLineParser;
	private NotificationSender notificationSender;

	public NotificationHandler(CommandLineParser commandLineParser) {
		this.commandLineParser = commandLineParser;
		if (commandLineParser.shouldNotifyWhenMalicious()) {
			if (commandLineParser.getNotificationType().equalsIgnoreCase("discord")) {
				notificationSender = new DiscordNotification();
			} else if (commandLineParser.getNotificationType().equalsIgnoreCase("popup")) {
				switch (OsCheck.getOperatingSystemType()) {
				case Windows:
					notificationSender = new WindowsNotification();
					break;
				// libNotify should also be available for Mac as far as i know
				case MacOS:
				case Linux:
					notificationSender = new LinuxNotification();
					break;
				default:
					Main.getInstance().getLogger().warn("Operating System could not be detected! Unable to send Notifications!");
				}
			}
		}
	}

	public void sendNotification(Path path, CheckResult result) {
		if (notificationSender == null) {
			return;
		}
		notificationSender.notifyDetectedFile(path, result);
	}

}
