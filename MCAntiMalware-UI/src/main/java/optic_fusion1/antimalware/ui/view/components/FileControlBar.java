package optic_fusion1.antimalware.ui.view.components;

import javafx.beans.property.BooleanProperty;
import javafx.beans.property.SimpleBooleanProperty;
import javafx.geometry.Insets;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.Tooltip;
import javafx.scene.layout.HBox;
import javafx.scene.layout.Priority;
import javafx.scene.layout.Region;
import optic_fusion1.antimalware.check.CheckResult;
import optic_fusion1.antimalware.ui.util.ImageUtil;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;

/**
 * A "control panel" for a detected file with the option to delete it via button-press.
 */
public class FileControlBar extends HBox {

    private final BooleanProperty deletedProperty = new SimpleBooleanProperty(false);

    private final Label fileNameLabel = new Label();
    private final Button deleteButton = new Button();
    private final Button removeButton = new Button();

    private final Path file;

    public FileControlBar(Path file, CheckResult checkResult) {

        this.file = file;

        setPadding(new Insets(5, 5, 5, 5));

        fileNameLabel.setText(file.getFileName().toString());
        fileNameLabel.setGraphic(ImageUtil.getImageView("images/warning_icon.png", ImageUtil.ImageResolution.SMALL));
        fileNameLabel.setTooltip(new Tooltip("Type:" + checkResult.getType() + " | Variant:" + checkResult.getVariant()));

        deleteButton.setGraphic(ImageUtil.getImageView("images/trash_icon.png",  ImageUtil.ImageResolution.SMALL));
        deleteButton.setTooltip(new Tooltip("Deletes the file from the disk"));

        removeButton.setGraphic(ImageUtil.getImageView("images/remove_icon.png",  ImageUtil.ImageResolution.SMALL));
        removeButton.setTooltip(new Tooltip("Removes the file from the list"));

        deleteButton.setOnAction((event) -> {
            try {
                Files.delete(file);
                deletedProperty.set(true);
            } catch (IOException e) {
                throw new RuntimeException(e);
            }
        });

        removeButton.setOnAction((event) -> deletedProperty.set(true));
    
        Region placeHolder = new Region();
        HBox.setHgrow(placeHolder, Priority.ALWAYS);

        getChildren().addAll(fileNameLabel, placeHolder, deleteButton, removeButton);
    }

    public Path getWrappedFile() {
        return file;
    }

    /**
     * @return A BooleanProperty that returns true if the file was deleted or removed.
     */
    public BooleanProperty deletedProperty() {
        return deletedProperty;
    }
}
