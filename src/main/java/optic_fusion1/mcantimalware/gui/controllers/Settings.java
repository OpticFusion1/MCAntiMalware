package optic_fusion1.mcantimalware.gui.controllers;

import javafx.beans.value.ChangeListener;
import javafx.beans.value.ObservableValue;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.ChoiceBox;
import javafx.scene.control.TextField;
import javafx.scene.control.ToggleButton;
import javafx.stage.DirectoryChooser;
import optic_fusion1.mcantimalware.gui.GuiLauncher;
import optic_fusion1.mcantimalware.gui.theme.ThemeLoader;
import optic_fusion1.mcantimalware.utils.FxGuiUtil;

import java.io.File;
import java.net.URL;
import java.util.ResourceBundle;

import static optic_fusion1.mcantimalware.AntiMalware.getMain;

public class Settings implements Initializable {
    @FXML
    private TextField scanDir;
    @FXML
    private ToggleButton zipMaliciousPlugins;
    @FXML
    private ToggleButton falsePositivesGalore;
    @FXML
    private ChoiceBox<String> themeChooser;

    @FXML
    public void chooseDir(){
        DirectoryChooser chooser = new DirectoryChooser();
        if(scanDir.getText() != null) {
            File f = new File(scanDir.getText());
            if(f.isDirectory()) chooser.setInitialDirectory(f);
        }
        File f = chooser.showDialog(GuiLauncher.stage);
        if(f != null){
            scanDir.setText(f.getPath());
        }
    }

    @FXML
    public void save(){
        getMain().getScanner().setScanDirectory(new File(scanDir.getText()));
        getMain().getScanner().setShouldZipMaliciousPlugins(zipMaliciousPlugins.isSelected());
        getMain().setFalsePositivesGalore(falsePositivesGalore.isSelected());
        GuiLauncher.applyTheme(themeChooser.getValue());
        GuiLauncher.saveConf();
        FxGuiUtil.info("Saved xD");
        GuiLauncher.openDashboard();
    }

    @FXML
    public void cancel(){
        GuiLauncher.openDashboard();
    }

    @FXML
    public void fpg(){
        if(falsePositivesGalore.isSelected()){
            falsePositivesGalore.setText("Enabled");
            falsePositivesGalore.getStyleClass().remove("btn-disable");
        } else {
            falsePositivesGalore.setText("Disabled");
            falsePositivesGalore.getStyleClass().add("btn-disable");
        }
    }

    @FXML
    public void zmp(){
        if(zipMaliciousPlugins.isSelected()){
            zipMaliciousPlugins.setText("Enabled");
            zipMaliciousPlugins.getStyleClass().remove("btn-disable");
        } else {
            zipMaliciousPlugins.setText("Disabled");
            zipMaliciousPlugins.getStyleClass().add("btn-disable");
        }
    }

    @Override
    public void initialize(URL url, ResourceBundle resourceBundle) {
        scanDir.setText(getMain().getScanner().getScanDirectory().getPath());
        zipMaliciousPlugins.setSelected(getMain().getScanner().shouldZipMaliciousPlugins());
        falsePositivesGalore.setSelected(getMain().falsePositivesGalore());
        zmp();
        fpg();

        themeChooser.getItems().addAll("default", "dark");
        themeChooser.getSelectionModel().select(GuiLauncher.getCurrentTheme().getName());
    }
}
