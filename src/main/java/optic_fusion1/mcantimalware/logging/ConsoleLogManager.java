package optic_fusion1.mcantimalware.logging;

import java.io.File;
import java.util.logging.ConsoleHandler;
import java.util.logging.FileHandler;
import java.util.logging.Handler;
import java.util.logging.Level;
import optic_fusion1.mcantimalware.Main;

public class ConsoleLogManager {

    private static CustomLogger logger = CustomLogger.getLogger("AntiMalware");
    private static CustomLogger global = CustomLogger.getLogger("");

    public static void init(Main main) {
        final ConsoleLogFormatter consolelogformatter = new ConsoleLogFormatter();
        ConsoleLogManager.logger.setUseParentHandlers(false);
        final ConsoleHandler consolehandler = new TerminalConsoleHandler(main.getConsoleReader());
        for (final Handler handler : ConsoleLogManager.global.getHandlers()) {
            ConsoleLogManager.global.removeHandler(handler);
        }
        consolehandler.setFormatter(new ShortConsoleLogFormatter(main));
        consolehandler.setLevel(Level.ALL);
        ConsoleLogManager.global.addHandler(consolehandler);
        ConsoleLogManager.logger.addHandler(consolehandler);
        try {
            File file = new File("AntiMalware", "log.log");
            if (!file.exists()) {
                file.getParentFile().mkdirs();
                file.createNewFile();
            }
            final FileHandler filehandler = new FileHandler(file.toString(), true);
            filehandler.setLevel(Level.ALL);
            filehandler.setFormatter(consolelogformatter);
            ConsoleLogManager.logger.addHandler(filehandler);
            ConsoleLogManager.global.addHandler(filehandler);
        } catch (Exception exception) {
            ConsoleLogManager.logger.log(Level.WARNING, "Failed to log to log.log", exception);
        }
    }
}
