package optic_fusion1.mcantimalware.utils;

import java.io.File;
import java.io.IOException;
import java.util.UUID;
import net.lingala.zip4j.ZipFile;
import optic_fusion1.mcantimalware.AntiMalware;
import optic_fusion1.mcantimalware.logging.CustomLogger;
import org.apache.commons.io.FileUtils;

public final class ZipUtils {

  private static final boolean SHOULD_EXCEPTIONS_BE_LOGGED =
      AntiMalware.getCommandLineHandler().shouldExceptionsBeLogged();
  private static final CustomLogger LOGGER = AntiMalware.getLogger();
  private static final File DATA_FOLDER = AntiMalware.getDataFolder();

  private ZipUtils() {}

  public static File unzipFileToTempDir(String source) {
    File unzippedDir = new File(DATA_FOLDER, "unzipped");
    if (!unzippedDir.exists()) {
      unzippedDir.mkdirs();
    }
    File tempDir = new File(unzippedDir, UUID.randomUUID().toString());
    if (!tempDir.exists()) {
      tempDir.mkdir();
    }
    try {
      ZipFile zipFile = new ZipFile(source);
      zipFile.extractAll(tempDir.toString());
      File file = new File(tempDir, "file.info");
      if (!file.exists()) {
        file.createNewFile();
      }
      FileUtils.writeStringToFile(file, source, "UTF-8");
    } catch (IOException ex) {
      if (SHOULD_EXCEPTIONS_BE_LOGGED) {
        LOGGER.exception(ex);
      }
    }
    return tempDir;
  }
}
